<% content_for :head do %>
  <meta name="turbolinks-cache-control" content="no-cache">
<% end %>
<% title @listing.title %>
<% meta_description @listing.description.truncate(150, separator: ' ') %>

<!-- <div class="center">
  <% @photos.each do |photo| %>
    <%= image_tag photo.image.url(), width: "100%", height: "350px" %>
  <% end %>
</div> -->
<!-- ENV["map_url"] -->
<div class="card">
  <div class="card-header" id="card-listing">
    <div class="row container-show">
      <div class="col-md-9 col-sm-8 col-12">
        <h3><%= @listing.listing_title %></h3>
        <span><%= @listing.location %></span>
      </div>
      <div class="d-none d-sm-block col-sm-4 col-md-3 ">
        <span class="pull-right"><%= pluralize(@listing.bedroom, "") %><i class="fa fa-bed"></i> &nbsp;&nbsp;&nbsp;&nbsp; <%= pluralize(@listing.bathroom, "") %><i class="fa fa-bath"></i><br> N<%= @listing.price || @listing.rent_price || @listing.short_stay_price %></span>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-8 col-sm-7">
      <div class="row">
        <div class="col-md-12 show_image_container">
          <div class="slider-for">
            <% @photos.each do |photo| %>
              <%= image_tag photo.image.url(), width: "100%", height: "500px" %>
            <% end %>
          </div>
          <div class="slider-nav">
            <% @photos.each do |photo| %>
              <%= image_tag photo.image.url(), width: "80px", height: "100px" %>
            <% end %>
          </div>
        </div><br>
        <!-- <div class="col-md-8 col-sm-6">
          <h1><%= @listing.listing_title %></h1>
          <%= @listing.location %>
        </div>
        <div class="col-md-4 col-sm-6">
          <%= image_tag avatar_url(@listing.user), class: "rounded-circle avatar_medium" %><br/>
          Listed By: <%= @listing.user.full_name %>
        </div><br> -->

        <!-- <div class="col-md-12 text-flister text-center row-space-1">
          <div class="row">
            <div class="col-md-3 col-6">
              <i class="fa fa-home fa-2x"></i><br>
              <div><%= @listing.listing_type %></div>
            </div>
            <div class="col-md-3 col-6">
              <i class="fa fa-user-circle-o fa-2x"></i><br>
              <div><%= @listing.property_type %></div>
            </div>
            <div class="col-md-3 col-6">
              <i class="fa fa-bed fa-2x"></i><br>
              <div><%= pluralize(@listing.bedroom, "Bedroom") %></div>
            </div>
            <div class="col-md-3 col-6">
              <i class="fa fa-bath fa-2x"></i><br>
                <div><%= pluralize(@listing.bathroom, "Bathroom") %></div>
            </div>
          </div>
        </div><br> --><br>

        <!-- About -->
        <div class="row">
          <div class="col-md-12">
            <h3>About <%= @listing.listing_title%></h3>
            <p><%= @listing.description %></p>
          </div>
        </div><br>


      <!-- GOOGLE MAP -->
      <div class="row">
        <div id="map"></div>

        <script src=ENV["map_url"]></script>
        <script>
          function initialize() {
            var location = {lat: <%= @listing.latitude %>, lng: <%= @listing.longitude %>};
            var map = new google.maps.Map(document.getElementById('map'), {
              center: location,
              zoom: 14
            });

            var marker = new google.maps.Marker({
              position: location,
              map: map
            });

            var infoWindow = new google.maps.InfoWindow({
              content: '<div id="content"><%= image_tag @listing.backgroud_image(:medium), width: "100%" %> <br><br><p><%= @listing.location %></p></div>'
            });

            infoWindow.open(map, marker);
          }
          // $(document).on("turbolinks:load", function(){
          //   initialize(<%= raw @listings.to_json %>)
          //   })

          google.maps.event.addDomListener(window, 'load', initialize);

        </script>
      </div>
      <hr/>



      <div class="col-md-12">
        <%= render 'comments/comment_form' %>

        <div id="comments" data-listing-id="<%= @listing.id %>">
          <%= render @listing.comments %>
        </div>
      </div>

      <!-- NEAR BY ROOMS -->
      <% if @listing.nearbys.length > 0 %>
          <div class="col-md-12">
            <h3>Nearby Similar Homes</h3>
            <div class="row">
              <% for listing in @listing.nearbys.limit(4) %>
                <div class="col-md-3 col-sm-6">
                  <div class="card">
                    <div class="card-header preview">
                      <%= image_tag listing.backgroud_image(:medium) %>
                    </div>
                    <div class="card-body">
                      <%= link_to listing.listing_title, listing %><br/>
                      (<%= listing.distance.round(2) %> miles away)
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>

      </div>
    </div>

    <div class="col-md-4 col-sm-5">
      <div class="card">
        <div class="card-header"></div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 col-sm-4 col-5">
              <%= image_tag avatar_url(@listing.user), class: "avatar_listing" %><br/>
            </div>
            <div class="col-md-8 col-sm-8 col-7">
              <span><%= @listing.user.full_name %></span><br>
              <span><% if @listing.user.phone %>
                  <i class="fa fa-phone">
                  &nbsp;&nbsp;<%= @listing.user.phone %>
                <% end %>
              </span>
              <span><%#= pluralize(@user.listings.length, "Listing") %></span>
              <%= link_to "All add by User", user_path(@listing.user)  %>
            </div>
          </div>
        </div>
      </div>
      <div class="availabilities-form">
        <%= render 'availabilities/form' %>
      </div><br>
      <div class="tell-a-friends-form">
        <%= render 'tell_a_friends/form' %>
      </div>
    </div>
  </div>
</div>


<script>
  $(document).ready(function() {

    $('.slider-for').slick({
      slidesToShow: 1,
      slidesToScroll: 1,
      arrows: true,
      fade: true,
      asNavFor: '.slider-nav'
    });
    $('.slider-nav').slick({
      slidesToShow: 5,
      slidesToScroll: 1,
      asNavFor: '.slider-for',
      dots: false,
      centerMode: true,
      focusOnSelect: true
    });

    // $('.center').slick({
    //   centerMode: true,
    //   centerPadding: '60px',
    //   slidesToShow: 3,
    //   arrows: true,
    //   infinite: true,
    //   speed: 300,
    //   dots: true,
    //   autoplay: true,
    //   autoplaySpeed: 3000,
    //   responsive: [
    //     {
    //     breakpoint: 868,
    //       settings: {
    //         arrows: true,
    //         centerMode: true,
    //         centerPadding: '40px',
    //         slidesToShow: 2
    //       }
    //     },
    //     {
    //       breakpoint: 550,
    //       settings: {
    //         arrows: true,
    //         centerMode: true,
    //         centerPadding: '40px',
    //         slidesToShow: 1
    //       }
    //     }
    //   ]
    // });
  });

</script>
